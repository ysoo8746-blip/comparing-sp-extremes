# Multiple Testing for Spatial Extremes with Application to Reanalysis Data Evaluation

This repository contains the R code and data required to reproduce the simulation study and real-data analysis presented in:

Yun, S., Li, B., and Zhang, X. (2026). Multiple Testing for Spatial Extremes with Application to Reanalysis Data Evaluation. *Journal of Computational and Graphical Statistics (Under Revision)*.

---

# Repository Structure
.
├── Climate Data/
├── Functions/
├── R/
├── Simulated Data/
└── README.md
---

## 1. Climate Data

This folder contains the climate datasets used in the real-data analysis.

(i) **Winter_AnnualMax_Precip0.Rdata**  
Contains winter annual maximum precipitation data from:
- ERA5 reanalysis
- CPC CONUS observational dataset

(ii) **NAM_Polygon_index.Rdata**  
Contains spatial polygon data for the contiguous United States used for regional indexing.

If raw data access is required, ERA5 data are publicly available from the Copernicus Climate Data Store, and CPC-CONUS data are publicly available from NOAA.

---

## 2. Functions

This folder includes all core R functions implementing the proposed methods.

- **GEVfunctions.R**  
  Fits the GEV model and computes return levels.

- **Neigh_Function.R**  
  Aggregates neighborhood information, combines p-values, and transforms them into test statistics.

- **Mirror_pi.R**  
  Estimates two-component and four-component mixture models and performs BiCLfdr.

- **Nonparam_functions.R**  
  Implements the Mirror procedure for multiple testing.

- **Optimal_Basis_functions.R**  
  Selects the optimal number of B-spline basis functions.

- **Multiple_Test_results.R**  
  Summarizes multiple testing results and generates ggplot-based visualizations.

All function files are sourced within the main scripts in the `R/` directory.

---

## 3. R (Main Analysis Scripts)

This folder contains scripts for both simulation and real-data analysis.

### Simulation Study

1. **Simulation_Rcode.R**  
   Generates simulated spatial extreme fields.

2. **Simulation_Permutation Test.R**  
   Fits GEV models to simulated data and performs permutation-based comparison between fields.

3. **Output_Simulation_Result.R**  
   Summarizes permutation test results and generates boxplots.

Simulation datasets are stored in:

Simulated Data/

---

### Real Data Analysis

4. **RealData_Analysis.R**  
   Compares extremes of ERA5 and CPC-CONUS winter maximum precipitation data.

This script:
- Loads climate data from `Climate Data/`
- Sources required functions from `Functions/`
- Performs model fitting and multiple testing
- Generates figures and summary outputs

---

## 4. Simulated Data

Contains simulated datasets used in the simulation study.

These files are generated by `Simulation_Rcode.R` and used by subsequent simulation scripts.

---

### For Simulation Results:

R/Simulation_Rcode.R
R/Simulation_Permutation Test.R
R/Output_Simulation_Result.R


### For Real Data Analysis:

R/RealData_Analysis.R


All required function files are automatically sourced.

---

# Required R Version and Packages

Tested with:
- R version 4.x.x
- macOS

Install required packages before running:

```r
install.packages(c(
  "tidyverse",
  "evd",
  "SpatialExtremes",
  "fields",
  "ggplot2",
  "parallel",
  "foreach",
  "doParallel"
))


