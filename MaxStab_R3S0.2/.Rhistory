Loc_Res1 = list(Weak = Loc_Multi_Weak, Moderate= Loc_Multi_Mod, Strong=Loc_Multi_Strong)
G.Loc1 = My_GG_MultiTestLoc(Loc_Res1, "Location", Method=m, Sig=s)
G.Loc1
dev.new()
G.Loc4 = My_GG_MultiTestLoc(Loc_Res4, "Location", Method=m, Sig=s)
G.Loc4
Loc_Multi_Strong = MyMulti_output("Strong_StrongCorrNei4", "Loc",Method=m)
Loc_Multi_Mod = MyMulti_output("Moderate_StrongCorrNei4","Loc",Method=m)
Loc_Multi_Weak= MyMulti_output("Weak_StrongCorrNei4","Loc", Method=m)
Loc_Res4 = list(Weak = Loc_Multi_Weak, Moderate= Loc_Multi_Mod, Strong=Loc_Multi_Strong)
G.Loc4 = My_GG_MultiTestLoc(Loc_Res4, "Location", Method=m, Sig=s)
G.Loc4
Scale_Multi_Strong = MyMulti_output("Strong_StrongCorrNei4", "Scale",Method=m)
Scale_Multi_Mod = MyMulti_output("Moderate_StrongCorrNei4","Scale",Method=m)
Scale_Multi_Weak= MyMulti_output("Weak_StrongCorrNei4","Scale",Method=m)
Scale_Res4 = list(Weak = Scale_Multi_Weak, Moderate= Scale_Multi_Mod, Strong=Scale_Multi_Strong)
Scale_Multi_Strong = MyMulti_output("Strong_StrongCorrNei4", "Scale",Method=m)
Scale_Multi_Mod = MyMulti_output("Moderate_StrongCorrNei4","Scale",Method=m)
Scale_Multi_Weak= MyMulti_output("Weak_StrongCorrNei4","Scale",Method=m)
Scale_Res4 = list(Weak = Scale_Multi_Weak, Moderate= Scale_Multi_Mod, Strong=Scale_Multi_Strong)
Scale_Multi_Strong = MyMulti_output("Strong_StrongCorrNei1", "Scale",Method=m)
Scale_Multi_Mod = MyMulti_output("Moderate_StrongCorrNei1","Scale",Method=m)
Scale_Multi_Weak= MyMulti_output("Weak_StrongCorrNei1","Scale",Method=m)
ind.w1 = which(Scale_Res1$Weak$Fdr[,4] ==1| Scale_Res1$Weak$FDR_R50[,4] ==1 | Scale_Res1$Weak$FDR_R10[,4] ==1)
ind.m1 = which(Scale_Res1$Moderate$Fdr[,4] ==1| Scale_Res1$Moderate$FDR_R50[,4] ==1 | Scale_Res1$Moderate$FDR_R10[,4] ==1)
ind.s1 = which(Scale_Res1$Strong$Fdr[,4] ==1| Scale_Res1$Strong$FDR_R50[,4] ==1 | Scale_Res1$Strong$FDR_R10[,4] ==1)
length(ind.w1); length(ind.m1); length(ind.s1)
ind.w4 = which(Scale_Res4$Weak$Fdr[,4] ==1| Scale_Res4$Weak$FDR_R50[,4] ==1 | Scale_Res4$Weak$FDR_R10[,4] ==1)
ind.m4 = which(Scale_Res4$Moderate$Fdr[,4] ==1| Scale_Res4$Moderate$FDR_R50[,4] ==1 | Scale_Res4$Moderate$FDR_R10[,4] ==1)
ind.s4 = which(Scale_Res4$Strong$Fdr[,4] ==1| Scale_Res4$Strong$FDR_R50[,4] ==1 | Scale_Res4$Strong$FDR_R10[,4] ==1)
length(ind.w4); length(ind.m4); length(ind.s4)
summary(Scale_Res1$Weak$Fdr)
G.Scale4 = My_GG_MultiTest(Scale_Res4, "Scale", Method=m, Sig=s)
G.Scale1 = My_GG_MultiTest(Scale_Res1, "Scale", Method=m, Sig=s)
G.Scale4
dev.new()
G.Scale1
Scale_Multi_Strong = MyMulti_output("Strong_StrongCorrNei1_2", "Scale",Method=m)
Scale_Multi_Mod = MyMulti_output("Moderate_StrongCorrNei1_2","Scale",Method=m)
Scale_Multi_Weak= MyMulti_output("Weak_StrongCorrNei1_2","Scale",Method=m)
Scale_Res1 = list(Weak = Scale_Multi_Weak, Moderate= Scale_Multi_Mod, Strong=Scale_Multi_Strong)
G.Scale1 = My_GG_MultiTest(Scale_Res1, "Scale", Method=m, Sig=s)
G.Scale1
ind.w1 = which(Scale_Res1$Weak$Fdr[,4] ==1| Scale_Res1$Weak$FDR_R50[,4] ==1 | Scale_Res1$Weak$FDR_R10[,4] ==1)
ind.m1 = which(Scale_Res1$Moderate$Fdr[,4] ==1| Scale_Res1$Moderate$FDR_R50[,4] ==1 | Scale_Res1$Moderate$FDR_R10[,4] ==1)
ind.s1 = which(Scale_Res1$Strong$Fdr[,4] ==1| Scale_Res1$Strong$FDR_R50[,4] ==1 | Scale_Res1$Strong$FDR_R10[,4] ==1)
length(ind.w1); length(ind.m1); length(ind.s1)
ind.w4 = which(Scale_Res4$Weak$Fdr[,4] ==1| Scale_Res4$Weak$FDR_R50[,4] ==1 | Scale_Res4$Weak$FDR_R10[,4] ==1)
ind.m4 = which(Scale_Res4$Moderate$Fdr[,4] ==1| Scale_Res4$Moderate$FDR_R50[,4] ==1 | Scale_Res4$Moderate$FDR_R10[,4] ==1)
ind.s4 = which(Scale_Res4$Strong$Fdr[,4] ==1| Scale_Res4$Strong$FDR_R50[,4] ==1 | Scale_Res4$Strong$FDR_R10[,4] ==1)
length(ind.w4); length(ind.m4); length(ind.s4)
Scale_Res1$Weak = lapply(Scale_Res1$Weak, function(x) x <- x[-ind.w1,])
Scale_Res1$Moderate = lapply(Scale_Res1$Moderate, function(x) x <- x[-ind.m1,])
Scale_Res1$Strong = lapply(Scale_Res1$Strong, function(x) x <- x[-ind.s1,])
G.Scale1 = My_GG_MultiTest(Scale_Res1, "Scale", Method=m, Sig=s)
G.Scale1
Scale_Multi_Strong = MyMulti_output("Strong_StrongCorrNei4", "Scale",Method=m)
Scale_Multi_Mod = MyMulti_output("Moderate_StrongCorrNei4","Scale",Method=m)
Scale_Multi_Weak= MyMulti_output("Weak_StrongCorrNei4","Scale",Method=m)
Scale_Res4 = list(Weak = Scale_Multi_Weak, Moderate= Scale_Multi_Mod, Strong=Scale_Multi_Strong)
Scale_Multi_Strong = MyMulti_output("Strong_StrongCorrNei1_2", "Scale",Method=m)
Scale_Multi_Mod = MyMulti_output("Moderate_StrongCorrNei1_2","Scale",Method=m)
Scale_Multi_Weak= MyMulti_output("Weak_StrongCorrNei1_2","Scale",Method=m)
Scale_Res1 = list(Weak = Scale_Multi_Weak, Moderate= Scale_Multi_Mod, Strong=Scale_Multi_Strong)
ind.w1 = which(Scale_Res1$Weak$Fdr[,4] ==1| Scale_Res1$Weak$FDR_R50[,4] ==1 | Scale_Res1$Weak$FDR_R10[,4] ==1)
ind.m1 = which(Scale_Res1$Moderate$Fdr[,4] ==1| Scale_Res1$Moderate$FDR_R50[,4] ==1 | Scale_Res1$Moderate$FDR_R10[,4] ==1)
ind.s1 = which(Scale_Res1$Strong$Fdr[,4] ==1| Scale_Res1$Strong$FDR_R50[,4] ==1 | Scale_Res1$Strong$FDR_R10[,4] ==1)
length(ind.w1); length(ind.m1); length(ind.s1)
Scale_Res1$Weak = lapply(Scale_Res1$Weak, function(x) x <- x[-ind.w1,])
Scale_Res1$Moderate = lapply(Scale_Res1$Moderate, function(x) x <- x[-ind.m1,])
Scale_Res1$Strong = lapply(Scale_Res1$Strong, function(x) x <- x[-ind.s1,])
Scale_Res4$Weak = lapply(Scale_Res4$Weak, function(x) x <- x[-ind.w1,])
Scale_Res4$Moderate = lapply(Scale_Res4$Moderate, function(x) x <- x[-ind.m1,])
Scale_Res4$Strong = lapply(Scale_Res4$Strong, function(x) x <- x[-ind.s1,])
G.Scale4 = My_GG_MultiTest(Scale_Res4, "Scale", Method=m, Sig=s)
G.Scale1 = My_GG_MultiTest(Scale_Res1, "Scale", Method=m, Sig=s)
dev.new()
G.Scale1 = My_GG_MultiTest(Scale_Res1, "Scale", Method=m, Sig=s)
G.Scale1
G.Scale1
dev.new()
G.Scale4
Shape_Multi_Strong = MyMulti_output("Moderate_StrongCorrNei4","Shape",Method=m)
Shape_Multi_Mod = MyMulti_output("Strong_StrongCorrNei4","Shape",Method=m)
Shape_Multi_Weak = MyMulti_output("Weak_StrongCorrNei4", "Shape", Method=m)
Shape_Res4 = list(Weak = Shape_Multi_Weak, Moderate= Shape_Multi_Mod, Strong=Shape_Multi_Strong)
Shape_Multi_Strong = MyMulti_output("Moderate_StrongCorrNei1","Shape",Method=m)
Shape_Multi_Mod = MyMulti_output("Strong_StrongCorrNei1","Shape",Method=m)
Shape_Multi_Weak = MyMulti_output("Weak_StrongCorrNei1", "Shape", Method=m)
Shape_Res1 = list(Weak = Shape_Multi_Weak, Moderate= Shape_Multi_Mod, Strong=Shape_Multi_Strong)
dev.new()
G.Shape1 = My_GG_MultiTest(Shape_Res1, "Shape", Method=m, Sig=s)
G.Shape1
dev.new()
G.Shape4 = My_GG_MultiTest(Shape_Res4, "Shape", Method=m, Sig=s)
G.Shape4
ind.w1 = which(Shape_Res1$Weak$Fdr[,4] ==1| Shape_Res1$Weak$FDR_R50[,4] ==1 | Shape_Res1$Weak$FDR_R10[,4] ==1)
ind.m1 = which(Shape_Res1$Moderate$Fdr[,4] ==1| Shape_Res1$Moderate$FDR_R50[,4] ==1 | Shape_Res1$Moderate$FDR_R10[,4] ==1)
ind.s1 = which(Shape_Res1$Strong$Fdr[,4] ==1| Shape_Res1$Strong$FDR_R50[,4] ==1 | Shape_Res1$Strong$FDR_R10[,4] ==1)
length(ind.w1); length(ind.m1); length(ind.s1)
Shape_Res1$Weak = lapply(Shape_Res1$Weak, function(x) x <- x[-ind.w1,])
Shape_Res1$Moderate = lapply(Shape_Res1$Moderate, function(x) x <- x[-ind.m1,])
Shape_Res1$Strong = lapply(Shape_Res1$Strong, function(x) x <- x[-ind.s1,])
Shape_Res4$Weak = lapply(Shape_Res4$Weak, function(x) x <- x[-ind.w1,])
Shape_Res4$Moderate = lapply(Shape_Res4$Moderate, function(x) x <- x[-ind.m1,])
Shape_Res4$Strong = lapply(Shape_Res4$Strong, function(x) x <- x[-ind.s1,])
G.Shape1 = My_GG_MultiTest(Shape_Res1, "Shape", Method=m, Sig=s)
G.Shape4 = My_GG_MultiTest(Shape_Res4, "Shape", Method=m, Sig=s)
G.Shape4
G.Shape4
dev.new()
G.Shape1
21942+13758
62500-35700
26800+62500
CUST<- read.csv("ACT3-CustomerTrans.dat", header= FALSE, sep=",")
setwd('/Users/sooinyun/Dropbox/Baruch/STA 9750/STA9750_S23/STAOPR9750')
CUST<- read.csv("ACT3-CustomerTrans.dat", header= FALSE, sep=",")
setwd('/Users/sooinyun/Dropbox/Baruch/STA 9750/STA9750_S23/STAOPR9750')
CUST<- read.csv("ACT3-CustomerTrans.dat", sep=",")
setwd('/Users/sooinyun/Dropbox/Baruch/STA 9750/STA9750_S23/STAOPR9750')
setwd('/Users/sooinyun/Dropbox/Baruch/STA 9750/STA9750_S23/STAOPR9750')
CUST<- read.csv("ACT3-CustomerTrans.dat", sep=",")
CUSTD = subset(CUST, Distance>=0)
mean(CUSTD$Amount)
CUSTD = subset(CUST, 'Distance'>=0)
mean(CUSTD$Amount)
pbinom(5, 10, 0.5)
pbinom(10, 10, 0.5)
####---- for loop review (looping over character vector)---####
#install.packages("regclass")
library(regclass) # load the package
data(DONOR)  # load the data "DONOR"
?DONOR
levels(DONOR$URBANICITY)        ## Tells the location of the donation
## [1] "?" "C" "R" "S" "T" "U"
### Example: calculate the average amount of donation for each location?
averages <- c() # (1) : initialize vector where we will be storing averages
# (2) create looping variable: "loc"
# (3) set looping values : levels(DONOR$URBANCITY) possible values (vector)
for (loc in levels(DONOR$URBANICITY) ) { #loop over the levels of URBANICITY
# approach 1 : use subset function
# iteration 1: loc = "?" => filter out the observation that have URBANCITY=="?"
# iteration 2: loc= "C"
SUB<-subset(DONOR,URBANICITY==loc)
avg.donation<-mean(SUB$Donation.Amount, na.rm=TRUE)  # line 10 and 11 can be combined
averages[loc] <- avg.donation #loc isnt a number, so will this work?
# approach 2: more efficient way to write code
#averages[loc] <- mean(DONOR$Donation.Amount[which(DONOR$URBANICITY==loc)], na.rm=TRUE)
}
averages
money[1] <- 10
money <- c() #vector that will keep track of bankroll
money[1] <- 10
#money = 10
number.of.bets <- 0 #Initialize a variable to keep track of the number of bets
set.seed(9750) #set random number seed for reproducibility
while ( min(money) > 0 ) {  # logical statement: keep track of the balance
result <- sample( c(-1,1),size=1,prob=c(20/38,18/38)) #get random outcome of bet
money <- c(money,tail(money,1) + result) #add an additional element (append a vector)
# tail(money,1) + result : updated balance / tail(money, 1) : last value of money vector (previous balance)
#print( paste("Balance is currently",tail(money,1) + result) )
number.of.bets <- number.of.bets + 1 #Increment the number of bets that have been made
}
number.of.bets
## [1] 100
plot(money, type="l")  # plots the balance of 100 games
money
#### ----- Tips for writing for loops ---- ####
library(regclass)
data(EX7.BIKE)
names(EX7.BIKE)
levels(EX7.BIKE$Day)
### Calculate the average for specific day (MONDAY)###
day <- "Monday" #arbitrarily choose Monday and get the code to work for this day
SUB <- subset(EX7.BIKE,Day==day) #take a subset of all rows with Monday,
#since that is what day equals now
avg.demand <- mean(SUB$Demand, na.rm=TRUE) #find average demand, removing any NAs if they happen
#to be present
avg.demand
?EX.BIKE
?EX7.BIKE
x <- c()
for (i in 1:5) {
cat(i)
x[i] <- 2*i-1
}
# probably not what we want (all the messages are printed one after each other with no spaces)
x <- c()
for (i in 1:5) {
print(i)
x[i] <- 2*i-1
}
### (1) cat and print commands
x <- c()
for (i in 1:5) {
cat(i)
x[i] <- 2*i-1
}
# probably not what we want (all the messages are printed one after each other with no spaces)
x <- c()
for (i in 1:5) {
print(i)
x[i] <- 2*i-1
}
### (2) paste command
paste("Hello","there","class")
## [1] "Hello there class"
x <- 5; y <- 2; z <- 3
paste("x is",x,"y is",y,"z is",z,sep=" * ")  # mix of text and numeric variable
## [1] "x is * 5 * y is * 2 * z is * 3"
for (i in 1:3) {
cat( paste("i is currently",i, "\n") ) #no return character -> all on same line
#\n makes any later output on the next line
}
for (i in 1:3) {
print( paste("i is currently",i) ) ## print command does not need "\n"
}
### Example 2 : Area code
# Want to distinguish whether the area code belongs to the TN area code
area.codes <- c(865,865,423,615,615,206,626,514,308,308,514,931,425) #data
tn.codes <- c(901,731,931,615,423,865) #area codes in TN
in.tennessee <- c() #create empty text vector
for (i in 1:length(area.codes)) { # looping variable : length(area.codes)
if( area.codes[i] %in% tn.codes ) { in.tennessee[i] <- "yes" } else { in.tennessee[i] <- "no" }
}
in.tennessee <- factor( in.tennessee ) #convert to a factor
table(in.tennessee)  #
### Example 2 : Area code
# Want to distinguish whether the area code belongs to the TN area code
area.codes <- c(865,865,423,615,615,206,626,514,308,308,514,931,425) #data
tn.codes <- c(901,731,931,615,423,865) #area codes in TN
in.tennessee <- c() #create empty text vector
for (i in 1:length(area.codes)) { # looping variable : length(area.codes)
if( area.codes[i] %in% tn.codes ) { in.tennessee[i] <- "yes" } else { in.tennessee[i] <- "no" }
}
table(in.tennessee)  # frequency table
class(in.tennessee)
8968-4486
## nested for loop
for( code.A in levels(DONOR$CLUSTER_CODE) ) {
for( code.B in levels(DONOR$CLUSTER_CODE) ) {
yes.A <- length( which( DONOR$Donate[which(DONOR$CLUSTER_CODE==code.A)] == "Yes" ) ) # count the number of ppl donated in code.A
yes.B <- length( which( DONOR$Donate[which(DONOR$CLUSTER_CODE==code.B)] == "Yes" ) )# count the number of ppl donated in code.B
n.A <- length( (which( DONOR$CLUSTER_CODE==code.A )) )
n.B <- length( (which( DONOR$CLUSTER_CODE==code.B )) )
d <- abs( yes.A/n.A - yes.B/n.B )
DIFF[ code.A, code.B ] <- round(d,digits=3)
}
}
## Create result matrix
# nlevels: count the number of different levels
DIFF <- matrix(NA,nrow=nlevels(DONOR$CLUSTER_CODE),ncol=nlevels(DONOR$CLUSTER_CODE)) #initialization
rownames(DIFF) <- levels(DONOR$CLUSTER_CODE)
colnames(DIFF) <- levels(DONOR$CLUSTER_CODE)
DIFF[ code.A, code.B ] <- round(d,digits=3) #Put d in row with name codeA (01) and column with name codeB DIFF[1:5,1:5]
## Check if the inner for loop is working for specific value of code.A
code.A <- "01" #Make sure code is working for this specific value of code.A
for( code.B in levels(DONOR$CLUSTER_CODE) ) {
yes.A <- length( which( DONOR$Donate[which(DONOR$CLUSTER_CODE==code.A)] == "Yes" ) )
yes.B <- length( which( DONOR$Donate[which(DONOR$CLUSTER_CODE==code.B)] == "Yes" ) )
n.A <- length( (which( DONOR$CLUSTER_CODE==code.A )) )
n.B <- length( (which( DONOR$CLUSTER_CODE==code.B )) )
d <- abs( yes.A/n.A - yes.B/n.B )  # difference
DIFF[ code.A, code.B ] <- round(d,digits=3)
}
DIFF[code.A,]
## nested for loop
for( code.A in levels(DONOR$CLUSTER_CODE) ) {
for( code.B in levels(DONOR$CLUSTER_CODE) ) {
yes.A <- length( which( DONOR$Donate[which(DONOR$CLUSTER_CODE==code.A)] == "Yes" ) ) # count the number of ppl donated in code.A
yes.B <- length( which( DONOR$Donate[which(DONOR$CLUSTER_CODE==code.B)] == "Yes" ) )# count the number of ppl donated in code.B
n.A <- length( (which( DONOR$CLUSTER_CODE==code.A )) )
n.B <- length( (which( DONOR$CLUSTER_CODE==code.B )) )
d <- abs( yes.A/n.A - yes.B/n.B )
DIFF[ code.A, code.B ] <- round(d,digits=3)
}
}
DIFF[1:6,1:6]
## check which elements have DIFF > 13.9%
which(DIFF>.139,arr.ind=TRUE)  # can apply which ftn to a matrix
DIFF[29,33]
levels(DONOR$CLUSTER_CODE)[c(29,33)]
summary(G.Scale4$Weak$FDR_R10)
summary(Scale_Res4$Weak$FDR_R10)
summary(Scale_Res1$Weak$FDR_R10)
dim(Scale_Res1$Weak$FDR_R10)
dim(Scale_Res4$Weak$FDR_R10)
summary(Scale_Res1$Weak$Power_R10)
summary(Scale_Res4$Weak$Power_R10)
setwd("/Users/sooinyun/Dropbox/Research/Comparing Extremes/newdata/NAM")
# save(delta.tr, loc, Loc.Sig1, Loc.Sig2, Loc.Sig3, Scale.Sig1, Scale.Sig2, Scale.Sig3, Shape.Sig1, Shape.Sig2, Shape.Sig3
#      , eval.loc, eval.sc, eval.sh , coeff.loc1, coeff.sc1, coeff.sh1 , coeff.loc2, coeff.sc2, coeff.sh2
#      ,param.loc00,param.scale00, param.shape00, coeff.loc3, coeff.sc3, coeff.sh3, param.loc0, param.scale0, param.shape0, file= "Sim_Param_StrongerCorr_shape2.Rdata")
load('Sim_Param_StrongerCorr_shape2.Rdata')
param.scale02 = param.scale0
param.scale02 = param.scale0 + (eval.sc %*% coeff.sc1)*1.2*delta.tr
# summary((eval.sp1 %*% coeff)[delta.tr==1])
# param.scale02[delta.tr==1] = param.scale0[delta.tr==1]+abs(param.scale0[delta.tr==1]-9)*2
##param.scale022[delta.tr==1] = param.scale0[delta.tr==1]+abs(param.scale0[delta.tr==1]-8)*1.5 #stronger
#param.scale02[delta.tr==1] = param.scale0[delta.tr==1]+abs(param.scale0[delta.tr==1]-8)*4 #even more stronger
#param.scale02 = pmin(param.scale02, 25)
summary(param.scale02)
param.loc.p0 = param.loc0; param.scale.p0 = param.scale0; param.shape.p0 = param.shape0
param.loc.p1 = param.loc0; param.scale.p1 = param.scale02; param.shape.p1 = param.shape0
tr.scale.diff.moderate = param.scale.p1-param.scale.p0
setwd('/Users/sooinyun/Dropbox/Research/Comparing Extremes/newdata/NAM/MaxStabData500')
ii = 16
load(paste0('MaxstabDataPrecip_R3_S0.2_', ii,'.Rdata'))
# Frechet to GEV
datax = datay = matrix(nrow=60, ncol= n.site)
for (i in 1:n.site){
datax[,i] <- frech2gev(data1[,i], param.loc.p0[i], param.scale.p0[i],param.shape.p0[i])
datay[,i] <- frech2gev(data2[,i], param.loc.p1[i], param.scale.p1[i],param.shape.p1[i])
datax[,i] = pmin(datax[,i], 5000); datax[,i] = pmax(0.05, datax[,i])
datay[,i] = pmin(datay[,i], 5000); datay[,i] = pmax(0.05, datay[,i])
}
t1=10; t2 = 20;t3 = 50; t4 = 100
rt.tr.x = gev.return_level(param.loc.p0, param.scale.p0, param.shape.p0, n.site, time=c( t1, t2, t3, t4))
rt.tr.y = gev.return_level(param.loc.p1, param.scale.p1, param.shape.p1, n.site, time=c(t1, t2, t3, t4))
rt.tr.diff.moderate =rt.tr.y-rt.tr.x
######--- FIT GEV at each location ----#############
start.GEV<- proc.time()
paramx.mle = paramy.mle= c()
pval_d = c()
n.site = ncol(datax)
for ( i in 1:ncol(datax)){
datX.NA = datax[,i]
datY.NA = datay[,i]
modx <-gev.fit(datX.NA, show=FALSE)#;modxA <-gev.fit(datX.A, show=FALSE)
mody <-gev.fit(datY.NA, show=FALSE)#;modyA <-gev.fit(datY.A, show=FALSE)
#stat_d = abs(mody$mle-modx$mle)[par]/sqrt(modx$cov[par,par] + mody$cov[par,par])
#ptmp = 2*(1-pnorm(stat_d))
#pval_d = c(pval_d, ptmp)
paramx.mle = rbind(paramx.mle, modx$mle)
paramy.mle = rbind(paramy.mle, mody$mle)
if (i %% 100 ==0) print(i)
}
end.GEV <- proc.time() - start.GEV
rl_10_GEVX <- gev.return_level(paramx.mle[,1], paramx.mle[,2], paramx.mle[,3], n.site, time = T[1])
rl_20_GEVX <- gev.return_level(paramx.mle[,1], paramx.mle[,2], paramx.mle[,3], n.site, time = T[2])
rl_50_GEVX <- gev.return_level(paramx.mle[,1], paramx.mle[,2], paramx.mle[,3], n.site, time = T[3])
rl_100_GEVX <- gev.return_level(paramx.mle[,1], paramx.mle[,2], paramx.mle[,3], n.site, time = T[4])
rl_10_GEVY <- gev.return_level(paramy.mle[,1], paramy.mle[,2], paramy.mle[,3], n.site, time = T[1])
rl_20_GEVY <- gev.return_level(paramy.mle[,1], paramy.mle[,2], paramy.mle[,3], n.site, time = T[2])
rl_50_GEVY <- gev.return_level(paramy.mle[,1], paramy.mle[,2], paramy.mle[,3], n.site, time = T[3])
rl_100_GEVY <- gev.return_level(paramy.mle[,1], paramy.mle[,2], paramy.mle[,3], n.site, time = T[4])
rt.diff.GEV = cbind(rl_10_GEVY-rl_10_GEVX, rl_20_GEVY-rl_20_GEVX, rl_50_GEVY-rl_50_GEVX
, rl_100_GEVY-rl_100_GEVX)
param.diff.mle = paramy.mle - paramx.mle
# return(list(RtD = rt.diff.GEV, ParamD = param.diff.mle, pval = pval_d))
# }
rt.diff.GEV.moderate =rt.diff.GEV
paramx.mle.moderate = paramx.mle
paramy.mle.moderate = paramy.mle
param.diff.mle.moderate = param.diff.mle
param.scale02 = param.scale0
param.scale02 = param.scale0 + (eval.sc %*% coeff.sc1)*delta.tr
# summary((eval.sp1 %*% coeff)[delta.tr==1])
# param.scale02[delta.tr==1] = param.scale0[delta.tr==1]+abs(param.scale0[delta.tr==1]-9)*2
##param.scale022[delta.tr==1] = param.scale0[delta.tr==1]+abs(param.scale0[delta.tr==1]-8)*1.5 #stronger
#param.scale02[delta.tr==1] = param.scale0[delta.tr==1]+abs(param.scale0[delta.tr==1]-8)*4 #even more stronger
#param.scale02 = pmin(param.scale02, 25)
summary(param.scale02)
param.loc.p0 = param.loc0; param.scale.p0 = param.scale0; param.shape.p0 = param.shape0
param.loc.p1 = param.loc0; param.scale.p1 = param.scale02; param.shape.p1 = param.shape0
tr.scale.diff.weak = param.scale.p1-param.scale.p0
######## --- Return level estimation --- ##########
setwd('/Users/sooinyun/Dropbox/Research/Comparing Extremes/newdata/NAM/MaxStabData500')
ii = 16
load(paste0('MaxstabDataPrecip_R3_S0.2_', ii,'.Rdata'))
# Frechet to GEV
datax = datay = matrix(nrow=60, ncol= n.site)
for (i in 1:n.site){
datax[,i] <- frech2gev(data1[,i], param.loc.p0[i], param.scale.p0[i],param.shape.p0[i])
datay[,i] <- frech2gev(data2[,i], param.loc.p1[i], param.scale.p1[i],param.shape.p1[i])
datax[,i] = pmin(datax[,i], 5000); datax[,i] = pmax(0.05, datax[,i])
datay[,i] = pmin(datay[,i], 5000); datay[,i] = pmax(0.05, datay[,i])
}
t1=10; t2 = 20;t3 = 50; t4 = 100
rt.tr.x = gev.return_level(param.loc.p0, param.scale.p0, param.shape.p0, n.site, time=c( t1, t2, t3, t4))
rt.tr.y = gev.return_level(param.loc.p1, param.scale.p1, param.shape.p1, n.site, time=c(t1, t2, t3, t4))
rt.tr.diff.weak =rt.tr.y-rt.tr.x
Rt = function(datax, datay, T, par){
#########--- FIT GEV at each location ----#############
start.GEV<- proc.time()
paramx.mle = paramy.mle= c()
pval_d = c()
n.site = ncol(datax)
for ( i in 1:ncol(datax)){
datX.NA = datax[,i]
datY.NA = datay[,i]
modx <-gev.fit(datX.NA, show=FALSE)#;modxA <-gev.fit(datX.A, show=FALSE)
mody <-gev.fit(datY.NA, show=FALSE)#;modyA <-gev.fit(datY.A, show=FALSE)
#stat_d = abs(mody$mle-modx$mle)[par]/sqrt(modx$cov[par,par] + mody$cov[par,par])
#ptmp = 2*(1-pnorm(stat_d))
#pval_d = c(pval_d, ptmp)
paramx.mle = rbind(paramx.mle, modx$mle)
paramy.mle = rbind(paramy.mle, mody$mle)
if (i %% 100 ==0) print(i)
}
end.GEV <- proc.time() - start.GEV
rl_10_GEVX <- gev.return_level(paramx.mle[,1], paramx.mle[,2], paramx.mle[,3], n.site, time = T[1])
rl_20_GEVX <- gev.return_level(paramx.mle[,1], paramx.mle[,2], paramx.mle[,3], n.site, time = T[2])
rl_50_GEVX <- gev.return_level(paramx.mle[,1], paramx.mle[,2], paramx.mle[,3], n.site, time = T[3])
rl_100_GEVX <- gev.return_level(paramx.mle[,1], paramx.mle[,2], paramx.mle[,3], n.site, time = T[4])
rl_10_GEVY <- gev.return_level(paramy.mle[,1], paramy.mle[,2], paramy.mle[,3], n.site, time = T[1])
rl_20_GEVY <- gev.return_level(paramy.mle[,1], paramy.mle[,2], paramy.mle[,3], n.site, time = T[2])
rl_50_GEVY <- gev.return_level(paramy.mle[,1], paramy.mle[,2], paramy.mle[,3], n.site, time = T[3])
rl_100_GEVY <- gev.return_level(paramy.mle[,1], paramy.mle[,2], paramy.mle[,3], n.site, time = T[4])
rt.diff.GEV = cbind(rl_10_GEVY-rl_10_GEVX, rl_20_GEVY-rl_20_GEVX, rl_50_GEVY-rl_50_GEVX
, rl_100_GEVY-rl_100_GEVX)
param.diff.mle = paramy.mle - paramx.mle
# return(list(RtD = rt.diff.GEV, ParamD
#######--- FIT GEV at each location ----#############
start.GEV<- proc.time()
paramx.mle = paramy.mle= c()
pval_d = c()
n.site = ncol(datax)
for ( i in 1:ncol(datax)){
datX.NA = datax[,i]
datY.NA = datay[,i]
modx <-gev.fit(datX.NA, show=FALSE)#;modxA <-gev.fit(datX.A, show=FALSE)
mody <-gev.fit(datY.NA, show=FALSE)#;modyA <-gev.fit(datY.A, show=FALSE)
#stat_d = abs(mody$mle-modx$mle)[par]/sqrt(modx$cov[par,par] + mody$cov[par,par])
#ptmp = 2*(1-pnorm(stat_d))
#pval_d = c(pval_d, ptmp)
paramx.mle = rbind(paramx.mle, modx$mle)
paramy.mle = rbind(paramy.mle, mody$mle)
if (i %% 100 ==0) print(i)
}
end.GEV <- proc.time() - start.GEV
rl_10_GEVX <- gev.return_level(paramx.mle[,1], paramx.mle[,2], paramx.mle[,3], n.site, time = T[1])
rl_20_GEVX <- gev.return_level(paramx.mle[,1], paramx.mle[,2], paramx.mle[,3], n.site, time = T[2])
rl_50_GEVX <- gev.return_level(paramx.mle[,1], paramx.mle[,2], paramx.mle[,3], n.site, time = T[3])
rl_100_GEVX <- gev.return_level(paramx.mle[,1], paramx.mle[,2], paramx.mle[,3], n.site, time = T[4])
rl_10_GEVY <- gev.return_level(paramy.mle[,1], paramy.mle[,2], paramy.mle[,3], n.site, time = T[1])
rl_20_GEVY <- gev.return_level(paramy.mle[,1], paramy.mle[,2], paramy.mle[,3], n.site, time = T[2])
rl_50_GEVY <- gev.return_level(paramy.mle[,1], paramy.mle[,2], paramy.mle[,3], n.site, time = T[3])
rl_100_GEVY <- gev.return_level(paramy.mle[,1], paramy.mle[,2], paramy.mle[,3], n.site, time = T[4])
rt.diff.GEV = cbind(rl_10_GEVY-rl_10_GEVX, rl_20_GEVY-rl_20_GEVX, rl_50_GEVY-rl_50_GEVX
, rl_100_GEVY-rl_100_GEVX)
param.diff.mle = paramy.mle - paramx.mle
# return(list(RtD = rt.diff.GEV, ParamD = param.diff.mle, pval = pval_d))
# }
rt.diff.GEV.weak =rt.diff.GEV
paramx.mle.weak = paramx.mle
paramy.mle.weak = paramy.mle
param.diff.mle.weak = param.diff.mle
param.scale02 = param.scale0
param.scale02 = param.scale0 + (eval.sc %*% coeff.sc1)*1.4*delta.tr
# summary((eval.sp1 %*% coeff)[delta.tr==1])
# param.scale02[delta.tr==1] = param.scale0[delta.tr==1]+abs(param.scale0[delta.tr==1]-9)*2
##param.scale022[delta.tr==1] = param.scale0[delta.tr==1]+abs(param.scale0[delta.tr==1]-8)*1.5 #stronger
#param.scale02[delta.tr==1] = param.scale0[delta.tr==1]+abs(param.scale0[delta.tr==1]-8)*4 #even more stronger
#param.scale02 = pmin(param.scale02, 25)
summary(param.scale02)
param.loc.p0 = param.loc0; param.scale.p0 = param.scale0; param.shape.p0 = param.shape0
param.loc.p1 = param.loc0; param.scale.p1 = param.scale02; param.shape.p1 = param.shape0
tr.scale.diff.strong = param.scale.p1-param.scale.p0
##### --- Return level estimation --- ##########
setwd('/Users/sooinyun/Dropbox/Research/Comparing Extremes/newdata/NAM/MaxStabData500')
ii = 16
load(paste0('MaxstabDataPrecip_R3_S0.2_', ii,'.Rdata'))
# Frechet to GEV
datax = datay = matrix(nrow=60, ncol= n.site)
for (i in 1:n.site){
datax[,i] <- frech2gev(data1[,i], param.loc.p0[i], param.scale.p0[i],param.shape.p0[i])
datay[,i] <- frech2gev(data2[,i], param.loc.p1[i], param.scale.p1[i],param.shape.p1[i])
datax[,i] = pmin(datax[,i], 5000); datax[,i] = pmax(0.05, datax[,i])
datay[,i] = pmin(datay[,i], 5000); datay[,i] = pmax(0.05, datay[,i])
}
t1=10; t2 = 20;t3 = 50; t4 = 100
rt.tr.x = gev.return_level(param.loc.p0, param.scale.p0, param.shape.p0, n.site, time=c( t1, t2, t3, t4))
rt.tr.y = gev.return_level(param.loc.p1, param.scale.p1, param.shape.p1, n.site, time=c(t1, t2, t3, t4))
rt.tr.diff.strong =rt.tr.y-rt.tr.x
###--- FIT GEV at each location ----#############
start.GEV<- proc.time()
paramx.mle = paramy.mle= c()
pval_d = c()
n.site = ncol(datax)
for ( i in 1:ncol(datax)){
datX.NA = datax[,i]
datY.NA = datay[,i]
modx <-gev.fit(datX.NA, show=FALSE)#;modxA <-gev.fit(datX.A, show=FALSE)
mody <-gev.fit(datY.NA, show=FALSE)#;modyA <-gev.fit(datY.A, show=FALSE)
#stat_d = abs(mody$mle-modx$mle)[par]/sqrt(modx$cov[par,par] + mody$cov[par,par])
#ptmp = 2*(1-pnorm(stat_d))
#pval_d = c(pval_d, ptmp)
paramx.mle = rbind(paramx.mle, modx$mle)
paramy.mle = rbind(paramy.mle, mody$mle)
if (i %% 100 ==0) print(i)
}
end.GEV <- proc.time() - start.GEV
rl_10_GEVX <- gev.return_level(paramx.mle[,1], paramx.mle[,2], paramx.mle[,3], n.site, time = T[1])
rl_20_GEVX <- gev.return_level(paramx.mle[,1], paramx.mle[,2], paramx.mle[,3], n.site, time = T[2])
rl_50_GEVX <- gev.return_level(paramx.mle[,1], paramx.mle[,2], paramx.mle[,3], n.site, time = T[3])
rl_100_GEVX <- gev.return_level(paramx.mle[,1], paramx.mle[,2], paramx.mle[,3], n.site, time = T[4])
rl_10_GEVY <- gev.return_level(paramy.mle[,1], paramy.mle[,2], paramy.mle[,3], n.site, time = T[1])
rl_20_GEVY <- gev.return_level(paramy.mle[,1], paramy.mle[,2], paramy.mle[,3], n.site, time = T[2])
rl_50_GEVY <- gev.return_level(paramy.mle[,1], paramy.mle[,2], paramy.mle[,3], n.site, time = T[3])
rl_100_GEVY <- gev.return_level(paramy.mle[,1], paramy.mle[,2], paramy.mle[,3], n.site, time = T[4])
rt.diff.GEV = cbind(rl_10_GEVY-rl_10_GEVX, rl_20_GEVY-rl_20_GEVX, rl_50_GEVY-rl_50_GEVX
, rl_100_GEVY-rl_100_GEVX)
param.diff.mle = paramy.mle - paramx.mle
# return(list(RtD = rt.diff.GEV, ParamD = p
rt.diff.GEV.strong =rt.diff.GEV
paramx.mle.strong = paramx.mle
paramy.mle.strong = paramy.mle
param.diff.mle.strong = param.diff.mle
summary(rt.diff.GEV.weak)
summary(rt.diff.GEV.strong)
